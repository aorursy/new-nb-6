#Importing Libraries

import numpy as np

import pandas as pd

import matplotlib.pyplot as plt
#Importing dataset

train = pd.read_csv('../input/train_1.csv').fillna(0)

page = train['Page']

train.head()
train.describe()
#Dropping Page Column

train = train.drop('Page',axis = 1)
#Using Data From Random Row for Training and Testing



row = train.iloc[90000,:].values # take only values, form 2D array

X = row[0:549]

y = row[1:550]



# Splitting the dataset into the Training set and Test set

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 0)







# Feature Scaling

from sklearn.preprocessing import MinMaxScaler

sc = MinMaxScaler()

X_train = np.reshape(X_train,(-1,1))

y_train = np.reshape(y_train,(-1,1))

X_train = sc.fit_transform(X_train)

y_train = sc.fit_transform(y_train)
#Training LSTM



#Reshaping Array

X_train = np.reshape(X_train, (384,1,1))





# Importing the Keras libraries and packages for LSTM

from keras.models import Sequential

from keras.layers import Dense

from keras.layers import LSTM



# Initialising the RNN

regressor = Sequential()



# Adding the input layerand the LSTM layer

regressor.add(LSTM(units = 8, activation = 'relu', input_shape = (None, 1)))





# Adding the output layer

regressor.add(Dense(units = 1))



# Compiling the RNN

regressor.compile(optimizer = 'adam', loss = 'mean_squared_error')



# Fitting the RNN to the Training set

regressor.fit(X_train, y_train, batch_size = 10, epochs = 100, verbose = 0)
# Getting the predicted Web View

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (165, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)
#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
#As you can see the prediction is quite accurate for a test set. Now repeat this for some other rows
row = train.iloc[0,:].values

X = row[0:549]

y = row[1:550]



# Splitting the dataset into the Training set and Test set

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 0)







# Feature Scaling

from sklearn.preprocessing import MinMaxScaler

sc = MinMaxScaler()

X_train = np.reshape(X_train,(-1,1))

y_train = np.reshape(y_train,(-1,1))

X_train = sc.fit_transform(X_train)

y_train = sc.fit_transform(y_train)



#Training LSTM



#Reshaping Array

X_train = np.reshape(X_train, (384,1,1))





# Importing the Keras libraries and packages for LSTM

from keras.models import Sequential

from keras.layers import Dense

from keras.layers import LSTM



# Initialising the RNN

regressor = Sequential()



# Adding the input layerand the LSTM layer

regressor.add(LSTM(units = 8, activation = 'relu', input_shape = (None, 1)))





# Adding the output layer

regressor.add(Dense(units = 1))



# Compiling the RNN

regressor.compile(optimizer = 'adam', loss = 'mean_squared_error')



# Fitting the RNN to the Training set

regressor.fit(X_train, y_train, batch_size = 10, epochs = 100, verbose = 0)



# Getting the predicted Web View

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (165, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
row = train.iloc[10,:].values

X = row[0:549]

y = row[1:550]



# Splitting the dataset into the Training set and Test set

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 0)







# Feature Scaling

from sklearn.preprocessing import MinMaxScaler

sc = MinMaxScaler()

X_train = np.reshape(X_train,(-1,1))

y_train = np.reshape(y_train,(-1,1))

X_train = sc.fit_transform(X_train)

y_train = sc.fit_transform(y_train)



#Training LSTM



#Reshaping Array

X_train = np.reshape(X_train, (384,1,1))





# Importing the Keras libraries and packages for LSTM

from keras.models import Sequential

from keras.layers import Dense

from keras.layers import LSTM



# Initialising the RNN

regressor = Sequential()



# Adding the input layerand the LSTM layer

regressor.add(LSTM(units = 8, activation = 'relu', input_shape = (None, 1)))





# Adding the output layer

regressor.add(Dense(units = 1))



# Compiling the RNN

regressor.compile(optimizer = 'adam', loss = 'mean_squared_error')



# Fitting the RNN to the Training set

regressor.fit(X_train, y_train, batch_size = 10, epochs = 100, verbose = 0)



# Getting the predicted Web View

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (165, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
row = train.iloc[100,:].values

X = row[0:549]

y = row[1:550]



# Splitting the dataset into the Training set and Test set

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 0)







# Feature Scaling

from sklearn.preprocessing import MinMaxScaler

sc = MinMaxScaler()

X_train = np.reshape(X_train,(-1,1))

y_train = np.reshape(y_train,(-1,1))

X_train = sc.fit_transform(X_train)

y_train = sc.fit_transform(y_train)



#Training LSTM



#Reshaping Array

X_train = np.reshape(X_train, (384,1,1))





# Importing the Keras libraries and packages for LSTM

from keras.models import Sequential

from keras.layers import Dense

from keras.layers import LSTM



# Initialising the RNN

regressor = Sequential()



# Adding the input layerand the LSTM layer

regressor.add(LSTM(units = 8, activation = 'relu', input_shape = (None, 1)))





# Adding the output layer

regressor.add(Dense(units = 1))



# Compiling the RNN

regressor.compile(optimizer = 'adam', loss = 'mean_squared_error')



# Fitting the RNN to the Training set

regressor.fit(X_train, y_train, batch_size = 10, epochs = 100, verbose = 0)



# Getting the predicted Web View

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (165, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
row = train.iloc[1000,:].values

X = row[0:549]

y = row[1:550]



# Splitting the dataset into the Training set and Test set

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.3, random_state = 0)







# Feature Scaling

from sklearn.preprocessing import MinMaxScaler

sc = MinMaxScaler()

X_train = np.reshape(X_train,(-1,1))

y_train = np.reshape(y_train,(-1,1))

X_train = sc.fit_transform(X_train)

y_train = sc.fit_transform(y_train)



#Training LSTM



#Reshaping Array

X_train = np.reshape(X_train, (384,1,1))





# Importing the Keras libraries and packages for LSTM

from keras.models import Sequential

from keras.layers import Dense

from keras.layers import LSTM



# Initialising the RNN

regressor = Sequential()



# Adding the input layerand the LSTM layer

regressor.add(LSTM(units = 8, activation = 'relu', input_shape = (None, 1)))





# Adding the output layer

regressor.add(Dense(units = 1))



# Compiling the RNN

regressor.compile(optimizer = 'adam', loss = 'mean_squared_error')



# Fitting the RNN to the Training set

regressor.fit(X_train, y_train, batch_size = 10, epochs = 100, verbose = 0)



# Getting the predicted Web View

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (165, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
#Now lets train on one page and test on another page

train_row = train.iloc[90000,:].values

X = train_row[0:549]

y = train_row[1:550]





# Feature Scaling

from sklearn.preprocessing import MinMaxScaler

sc = MinMaxScaler()

X_train = np.reshape(X,(-1,1))

y_train = np.reshape(y,(-1,1))

X_train = sc.fit_transform(X_train)

y_train = sc.fit_transform(y_train)



#Training LSTM



#Reshaping Array

X_train = np.reshape(X_train, (549,1,1))





# Importing the Keras libraries and packages for LSTM

from keras.models import Sequential

from keras.layers import Dense

from keras.layers import LSTM



# Initialising the RNN

regressor = Sequential()



# Adding the input layerand the LSTM layer

regressor.add(LSTM(units = 8, activation = 'relu', input_shape = (None, 1)))





# Adding the output layer

regressor.add(Dense(units = 1))



# Compiling the RNN

regressor.compile(optimizer = 'adam', loss = 'mean_squared_error')



# Fitting the RNN to the Training set

regressor.fit(X_train, y_train, batch_size = 10, epochs = 100, verbose = 0)



# Getting the predicted Web View

test_row = train.iloc[10000,:].values

X_test = test_row[0:549]

y_test = test_row[1:550]

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (549, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
#Repeating on another page

# Getting the predicted Web View

test_row = train.iloc[5000,:].values

X_test = test_row[0:549]

y_test = test_row[1:550]

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (549, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
# Getting the predicted Web View

import random

X_value = random.randint(0,train.shape[0])

test_row = train.iloc[X_value,:].values

X_test = test_row[0:549]

y_test = test_row[1:550]

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (549, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting for')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
# Getting the predicted Web View

import random

X_value = random.randint(0,train.shape[0])

test_row = train.iloc[X_value,:].values

X_test = test_row[0:549]

y_test = test_row[1:550]

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (549, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting for')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
# Getting the predicted Web View

import random

X_value = random.randint(0,train.shape[0])

test_row = train.iloc[X_value,:].values

X_test = test_row[0:549]

y_test = test_row[1:550]

inputs = X_test

inputs = np.reshape(inputs,(-1,1))

inputs = sc.transform(inputs)

inputs = np.reshape(inputs, (549, 1, 1))

y_pred = regressor.predict(inputs)

y_pred = sc.inverse_transform(y_pred)



#Visualising Result

plt.figure

plt.plot(y_test, color = 'red', label = 'Real Web View')

plt.plot(y_pred, color = 'blue', label = 'Predicted Web View')

plt.title('Web View Forecasting for')

plt.xlabel('Number of Days from Start')

plt.ylabel('Web View')

plt.legend()

plt.show()
# Getting the Mean Web View - 1000 Pages

y_test_mean = []

y_pred_mean = []

for X_value in range(0,1000):

    test_row = train.iloc[X_value,:].values

    X_test = test_row[0:549]

    y_test = test_row[1:550]

    y_test_mean.append(np.mean(y_test))

    inputs = X_test

    inputs = np.reshape(inputs,(-1,1))

    inputs = sc.transform(inputs)

    inputs = np.reshape(inputs, (549, 1, 1))

    y_pred = regressor.predict(inputs)

    y_pred = sc.inverse_transform(y_pred)

    y_pred_mean.append(np.mean(y_pred))
#Visualising mean

plt.figure

plt.plot(y_test_mean, color = 'red', label = 'Mean Real Web View')

plt.plot(y_pred_mean, color = 'blue', label = 'Mean Predicted Web View')

plt.title('Mean Web View Forecasting')

plt.xlabel('Index of Page')

plt.ylabel('Mean Web View')

plt.legend()

plt.show()
# Getting the Mean Web View - 100 Pages

y_test_mean = []

y_pred_mean = []

for X_value in range(0,100):

    test_row = train.iloc[X_value,:].values

    X_test = test_row[0:549]

    y_test = test_row[1:550]

    y_test_mean.append(np.mean(y_test))

    inputs = X_test

    inputs = np.reshape(inputs,(-1,1))

    inputs = sc.transform(inputs)

    inputs = np.reshape(inputs, (549, 1, 1))

    y_pred = regressor.predict(inputs)

    y_pred = sc.inverse_transform(y_pred)

    y_pred_mean.append(np.mean(y_pred))

    

#Visualising mean

plt.figure

plt.plot(y_test_mean, color = 'red', label = 'Mean Real Web View')

plt.plot(y_pred_mean, color = 'blue', label = 'Mean Predicted Web View')

plt.title('Mean Web View Forecasting')

plt.xlabel('Index of Page')

plt.ylabel('Mean Web View')

plt.legend()

plt.show()
# Getting the Mean Web View - random 100 Pages in between

pages = np.random.randint(0,train.shape[0],100)

y_test_mean = []

y_pred_mean = []

for X_value in pages:

    test_row = train.iloc[X_value,:].values

    X_test = test_row[0:549]

    y_test = test_row[1:550]

    y_test_mean.append(np.mean(y_test))

    inputs = X_test

    inputs = np.reshape(inputs,(-1,1))

    inputs = sc.transform(inputs)

    inputs = np.reshape(inputs, (549, 1, 1))

    y_pred = regressor.predict(inputs)

    y_pred = sc.inverse_transform(y_pred)

    y_pred_mean.append(np.mean(y_pred))

    

#Visualising mean

plt.figure

plt.plot(y_test_mean, color = 'red', label = 'Mean Real Web View')

plt.plot(y_pred_mean, color = 'blue', label = 'Mean Predicted Web View')

plt.title('Mean Web View Forecasting')

plt.ylabel('Mean Web View')

plt.legend()

plt.show()
# Getting the Mean Web View - random 100 Pages in between

pages = np.random.randint(0,train.shape[0],100)

y_test_mean = []

y_pred_mean = []

for X_value in pages:

    test_row = train.iloc[X_value,:].values

    X_test = test_row[0:549]

    y_test = test_row[1:550]

    y_test_mean.append(np.mean(y_test))

    inputs = X_test

    inputs = np.reshape(inputs,(-1,1))

    inputs = sc.transform(inputs)

    inputs = np.reshape(inputs, (549, 1, 1))

    y_pred = regressor.predict(inputs)

    y_pred = sc.inverse_transform(y_pred)

    y_pred_mean.append(np.mean(y_pred))

    

#Visualising mean

plt.figure

plt.plot(y_test_mean, color = 'red', label = 'Mean Real Web View')

plt.plot(y_pred_mean, color = 'blue', label = 'Mean Predicted Web View')

plt.title('Mean Web View Forecasting')

plt.ylabel('Mean Web View')

plt.legend()

plt.show()